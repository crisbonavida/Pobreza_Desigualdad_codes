<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Capítulo 2 | Apéndices del Libro Pobreza y Desigualdad en R</title>
  <meta name="description" content="Nos propusimos trasncribir al lenguaje R y Python los apéndices del libro Pobreza y Desigualdad en América Latina de Gasparini, Cicowiez y Sosa Escudero que originalmente fueron escritos para Stata." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Capítulo 2 | Apéndices del Libro Pobreza y Desigualdad en R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/portada_libro_cover.png" />
  <meta property="og:description" content="Nos propusimos trasncribir al lenguaje R y Python los apéndices del libro Pobreza y Desigualdad en América Latina de Gasparini, Cicowiez y Sosa Escudero que originalmente fueron escritos para Stata." />
  <meta name="github-repo" content="crisbonavida/Pobreza_Desigualdad_codes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Capítulo 2 | Apéndices del Libro Pobreza y Desigualdad en R" />
  
  <meta name="twitter:description" content="Nos propusimos trasncribir al lenguaje R y Python los apéndices del libro Pobreza y Desigualdad en América Latina de Gasparini, Cicowiez y Sosa Escudero que originalmente fueron escritos para Stata." />
  <meta name="twitter:image" content="/portada_libro_cover.png" />



<meta name="date" content="2022-02-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="capítulo-3.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Una herramienta práctica para trabajar con datos</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Bienvenidos</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sobre-este-proyecto"><i class="fa fa-check"></i>Sobre este Proyecto:</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#el-libro"><i class="fa fa-check"></i>El Libro</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="capítulo-2.html"><a href="capítulo-2.html"><i class="fa fa-check"></i><b>2</b> Capítulo 2</a>
<ul>
<li class="chapter" data-level="" data-path="capítulo-2.html"><a href="capítulo-2.html#set-inicial"><i class="fa fa-check"></i>Set Inicial</a></li>
<li class="chapter" data-level="2.1" data-path="capítulo-2.html"><a href="capítulo-2.html#introducción-ejemplo-brasil"><i class="fa fa-check"></i><b>2.1</b> Introducción: ejemplo Brasil</a></li>
<li class="chapter" data-level="2.2" data-path="capítulo-2.html"><a href="capítulo-2.html#histogramas"><i class="fa fa-check"></i><b>2.2</b> Histogramas</a></li>
<li class="chapter" data-level="2.3" data-path="capítulo-2.html"><a href="capítulo-2.html#función-de-distribución"><i class="fa fa-check"></i><b>2.3</b> Función de distribución</a></li>
<li class="chapter" data-level="2.4" data-path="capítulo-2.html"><a href="capítulo-2.html#pareto"><i class="fa fa-check"></i><b>2.4</b> Pareto</a></li>
<li class="chapter" data-level="2.5" data-path="capítulo-2.html"><a href="capítulo-2.html#box-plot"><i class="fa fa-check"></i><b>2.5</b> Box-plot</a></li>
<li class="chapter" data-level="2.6" data-path="capítulo-2.html"><a href="capítulo-2.html#curva-de-lorenz"><i class="fa fa-check"></i><b>2.6</b> Curva de Lorenz</a></li>
<li class="chapter" data-level="2.7" data-path="capítulo-2.html"><a href="capítulo-2.html#curva-generalizada-de-lorenz"><i class="fa fa-check"></i><b>2.7</b> Curva Generalizada de Lorenz</a></li>
<li class="chapter" data-level="2.8" data-path="capítulo-2.html"><a href="capítulo-2.html#curva-de-incidencia"><i class="fa fa-check"></i><b>2.8</b> Curva de Incidencia</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="capítulo-3.html"><a href="capítulo-3.html"><i class="fa fa-check"></i><b>3</b> Capítulo 3</a>
<ul>
<li class="chapter" data-level="" data-path="capítulo-3.html"><a href="capítulo-3.html#set-inicial-1"><i class="fa fa-check"></i>Set Inicial</a></li>
<li class="chapter" data-level="3.1" data-path="capítulo-3.html"><a href="capítulo-3.html#cociente-de-cuantiles"><i class="fa fa-check"></i><b>3.1</b> Cociente de cuantiles</a></li>
<li class="chapter" data-level="3.2" data-path="capítulo-3.html"><a href="capítulo-3.html#replicar-programa-ratq51"><i class="fa fa-check"></i><b>3.2</b> Replicar programa ratq51</a></li>
<li class="chapter" data-level="3.3" data-path="capítulo-3.html"><a href="capítulo-3.html#replicar-programa-gcuan"><i class="fa fa-check"></i><b>3.3</b> Replicar programa gcuan</a></li>
<li class="chapter" data-level="3.4" data-path="capítulo-3.html"><a href="capítulo-3.html#tamaño-de-los-hogares"><i class="fa fa-check"></i><b>3.4</b> Tamaño de los hogares</a></li>
<li class="chapter" data-level="3.5" data-path="capítulo-3.html"><a href="capítulo-3.html#la-distribución-intrahogar"><i class="fa fa-check"></i><b>3.5</b> La distribución intrahogar</a></li>
<li class="chapter" data-level="3.6" data-path="capítulo-3.html"><a href="capítulo-3.html#empleo-de-ponderadores"><i class="fa fa-check"></i><b>3.6</b> Empleo de ponderadores</a></li>
<li class="chapter" data-level="3.7" data-path="capítulo-3.html"><a href="capítulo-3.html#diseño-muestral"><i class="fa fa-check"></i><b>3.7</b> Diseño muestraL</a></li>
<li class="chapter" data-level="3.8" data-path="capítulo-3.html"><a href="capítulo-3.html#fuentes-de-ingreso"><i class="fa fa-check"></i><b>3.8</b> Fuentes de ingreso</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="capítulo-4.html"><a href="capítulo-4.html"><i class="fa fa-check"></i><b>4</b> Capítulo 4</a>
<ul>
<li class="chapter" data-level="" data-path="capítulo-4.html"><a href="capítulo-4.html#set-inicial-2"><i class="fa fa-check"></i>Set Inicial</a></li>
<li class="chapter" data-level="4.1" data-path="capítulo-4.html"><a href="capítulo-4.html#indicador-fgt"><i class="fa fa-check"></i><b>4.1</b> Indicador FGT</a></li>
<li class="chapter" data-level="4.2" data-path="capítulo-4.html"><a href="capítulo-4.html#computar-fgt"><i class="fa fa-check"></i><b>4.2</b> Computar FGT</a></li>
<li class="chapter" data-level="4.3" data-path="capítulo-4.html"><a href="capítulo-4.html#pobreza-relativa"><i class="fa fa-check"></i><b>4.3</b> Pobreza relativa</a></li>
<li class="chapter" data-level="4.4" data-path="capítulo-4.html"><a href="capítulo-4.html#descompoisición-regional-de-la-pobreza"><i class="fa fa-check"></i><b>4.4</b> Descompoisición regional de la pobreza</a></li>
<li class="chapter" data-level="4.5" data-path="capítulo-4.html"><a href="capítulo-4.html#pobreza-según-consumo-e-ingreso"><i class="fa fa-check"></i><b>4.5</b> Pobreza según consumo e ingreso</a></li>
<li class="chapter" data-level="4.6" data-path="capítulo-4.html"><a href="capítulo-4.html#pobreza-por-edad"><i class="fa fa-check"></i><b>4.6</b> Pobreza por edad</a></li>
<li class="chapter" data-level="4.7" data-path="capítulo-4.html"><a href="capítulo-4.html#significatividad-estadistica"><i class="fa fa-check"></i><b>4.7</b> Significatividad estadistica</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="capítulo-5.html"><a href="capítulo-5.html"><i class="fa fa-check"></i><b>5</b> Capítulo 5</a>
<ul>
<li class="chapter" data-level="" data-path="capítulo-5.html"><a href="capítulo-5.html#set-inicial-3"><i class="fa fa-check"></i>Set Inicial</a></li>
<li class="chapter" data-level="5.1" data-path="capítulo-5.html"><a href="capítulo-5.html#pobreza-multidimensional"><i class="fa fa-check"></i><b>5.1</b> Pobreza Multidimensional</a></li>
<li class="chapter" data-level="5.2" data-path="capítulo-5.html"><a href="capítulo-5.html#indice-bourguignon-y-chakravarty-bc---pobreza-multidimensional"><i class="fa fa-check"></i><b>5.2</b> Indice Bourguignon y Chakravarty (BC) - Pobreza Multidimensional</a></li>
<li class="chapter" data-level="5.3" data-path="capítulo-5.html"><a href="capítulo-5.html#indice-alkire-y-foster-af---pobreza-multidimensional"><i class="fa fa-check"></i><b>5.3</b> Indice Alkire y Foster (AF) - Pobreza Multidimensional</a></li>
<li class="chapter" data-level="5.4" data-path="capítulo-5.html"><a href="capítulo-5.html#perfiles-de-pobreza"><i class="fa fa-check"></i><b>5.4</b> Perfiles de Pobreza</a></li>
<li class="chapter" data-level="5.5" data-path="capítulo-5.html"><a href="capítulo-5.html#perfiles-de-pobreza-condicionados"><i class="fa fa-check"></i><b>5.5</b> Perfiles de Pobreza Condicionados</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Apéndices del Libro Pobreza y Desigualdad en R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="capítulo-2" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Capítulo 2</h1>
<div id="apéndices-del-libro-pobreza-y-desigualdad-en-r" class="section level2 unlisted unnumbered">
<h2>Apéndices del Libro Pobreza y Desigualdad en R</h2>
<div id="escrito-por-cristian-bonavida" class="section level4 unnumbered">
<h4>Escrito por: Cristian Bonavida</h4>
</div>
<div id="last-update-0272021" class="section level4 unnumbered">
<h4>Last Update: 02/7/2021</h4>
<p>
 
</p>
<p><em>Códigos escritos en base a los apéndices del libro “Pobreza y Desigualdad en América Latina” de Gasparini, Cicowiez y Sosa Escudero. El objeto de este material es reproducir la rutina de códigos para STATA presentada en el libro al lenguaje R. Este material es solo de caracter complementario a las explicaciones y detalles conceptuales que se presentan en el libro de texto y los apéndices</em></p>
<p>
 
</p>
</div>
</div>
<div id="set-inicial" class="section level2 unnumbered">
<h2>Set Inicial</h2>
<p>Cargo las librerias, limpio environment, defino el path y atajo para función paste</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="capítulo-2.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="capítulo-2.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># Data wrangling</span></span>
<span id="cb1-3"><a href="capítulo-2.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidygraph)</span>
<span id="cb1-4"><a href="capítulo-2.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-5"><a href="capítulo-2.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="capítulo-2.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb1-7"><a href="capítulo-2.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb1-8"><a href="capítulo-2.html#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="capítulo-2.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())    <span class="co">#empiezo limpiando todo </span></span>
<span id="cb1-10"><a href="capítulo-2.html#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="capítulo-2.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;%+%&quot;</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y) <span class="fu">paste</span>(x,y,<span class="at">sep =</span> <span class="st">&quot;&quot;</span>)      <span class="co"># defino un shorcut parar concat de texto</span></span>
<span id="cb1-12"><a href="capítulo-2.html#cb1-12" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/HP/Desktop/CEDLAS - UNLP/Apendices en R/Material libro/encuestas-cedlas/Encuestas/&quot;</span>  <span class="co">#seteo directorio </span></span></code></pre></div>
<p>
 
</p>
</div>
<div id="introducción-ejemplo-brasil" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Introducción: ejemplo Brasil</h2>
<p>###- (pág. 72)</p>
<p>El siguiente código es introductorio y busca guiar al lector en la sintaxis básica a utilizar, mostrando a modo de ejemplo cómo replicar los resultados correspondientes al cuadro 2.1 del texto.</p>
<p>Para ello como al inicio de cada capítulo el primer paso es obtener base de datos, en ese caso la versión procesada de la PNAD (Pesquisa Nacional por Amostra de Domicílios) de Brasil para el año 2007, accesible desde el link de descarga indicado en la sección anterior: datos y set up básico. (Añadir sección y referir allí)</p>
<p>Una vez descargada la encuesta y guardada en el directorio que el lector indicó al definir el objeto data_dir se carga la encuesta que se encuentra en formato STATA utilizando, de la librería <code>foreing</code>, el comando <code>read.dta</code> que permite importar en R bases de datos que están en formatos compatibles con otros programas o lenguajes. Las encuestas de hogares procesadas que se utilizan a lo largo del libro solo contienen observaciones que denominamos coherentes (ver capítulo 3), que en pocas palabras se trata de observaciones válidas que utilizamos en el cálculo de los ingresos familiares. Por ello siempre que se cargue una base luego se debe filtrarla a partir de la columna <em>cohh</em>, para quedarse solo con estas observaciones. De igual para asegurarnos eliminamos cualquier valor “missing” o cero de la variable ingreso.</p>
<p>Las encuestas de hogares, al igual que cualquier otra base de datos, se organizan en R como objetos tipo tabla que reciben el nombre de <code>dataframe</code>, donde las filas representan observaciones o registros y las columnas variables o campos. Con el comando <code>head</code> podemos explorar las primeras observaciones de la encuesta (<code>[,1:9]</code> indica incluir solo de la columna 1 a 9 para que el output no sea demasiado extenso)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="capítulo-2.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cargo base</span></span>
<span id="cb2-2"><a href="capítulo-2.html#cb2-2" aria-hidden="true" tabindex="-1"></a>bra07 <span class="ot">&lt;-</span> <span class="fu">read.dta</span>(data_dir <span class="sc">%+%</span> <span class="st">&quot;Bra/2007/Bases/bra07_cedlas.dta&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="capítulo-2.html#cb2-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(cohh<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(ipcf) <span class="sc">&amp;</span> ipcf<span class="sc">!=</span><span class="dv">0</span>)</span>
<span id="cb2-4"><a href="capítulo-2.html#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="capítulo-2.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bra07[,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>])</span></code></pre></div>
<pre><code>##      edad relacion tarea hstrp pondera pais  ano  encuesta    id
## 9765   43        1    NA    50     871  bra 2007 PNAD-2007 16026
## 9766   37        2    NA    40     871  bra 2007 PNAD-2007 16026
## 9767    5        3    NA    NA     871  bra 2007 PNAD-2007 16026
## 9768   12        3    NA    NA     871  bra 2007 PNAD-2007 16026
## 9769   13        3    NA    NA     871  bra 2007 PNAD-2007 16026
## 9770   15        3    NA    24     871  bra 2007 PNAD-2007 16026</code></pre>
<p>A su vez, por tratarse de una encuesta, cada observación representa a varios individuos, tantos como indica el factor de expansión o variable de ponderación. En nuestro caso, todas las encuestas que utilizaremos contienen una variable de nombre <em>“pondera”</em> que almacena el factor de expansión. Para más detalles sobre el uso de ponderadores, consultar más adelante la sección 3.6 del capítulo 3.</p>
<p>Para expandir las observaciones por su peso muestral debemos emplear alguna de las librerías disponibles creadas para tal fin, ya que “por default” los comandos base de R no estiman estadísticos ponderados, como es el caso por ejemplo del comando <code>summary</code>. Si se comparan los valores que arroja respecto a los valores de los mismos estadísticos pero ponderados, es evidente que existen diferencias (excepto obviamente para el mínimo y el máximo). Existen varias librerías que nos permiten obtener los mismos descriptivos ponderados, aquí se presentan los resultados con el uso de <code>Hmisc</code> pero también puede explorarse de forma similar las librerías <code>TAM</code> y <code>srvy</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="capítulo-2.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary no arroja estadísticas descriptivas ponderadas</span></span>
<span id="cb4-2"><a href="capítulo-2.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bra07<span class="sc">$</span>ipcf)</span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
##     0.16   165.88   320.49   573.30   601.99 66000.00</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="capítulo-2.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#replicar la información que nos da summary pero ponderandola - usando libreria Hmisc</span></span>
<span id="cb6-2"><a href="capítulo-2.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wtd.mean</span>(bra07<span class="sc">$</span>ipcf, <span class="at">w=</span>bra07<span class="sc">$</span>pondera)</span></code></pre></div>
<pre><code>## [1] 588.011</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="capítulo-2.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wtd.quantile</span>(bra07<span class="sc">$</span>ipcf, <span class="at">probs =</span><span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>) , <span class="at">w=</span>bra07<span class="sc">$</span>pondera)</span></code></pre></div>
<pre><code>##      25%      50%      75% 
## 175.0048 337.3586 632.5000</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="capítulo-2.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(bra07<span class="sc">$</span>ipcf, <span class="at">na.rm =</span>T)</span></code></pre></div>
<pre><code>## [1] 0.1571429</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="capítulo-2.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(bra07<span class="sc">$</span>ipcf, <span class="at">na.rm =</span>T)</span></code></pre></div>
<pre><code>## [1] 66000</code></pre>
<p>Mientras que la media no pondera es de 555.5 al ponderar el valor estimado es 569.6. Lo mismo ocurre para la mediana, el primer y el tercer cuartil de la distribución.</p>
<p>Una opción recomendada para usuarios más familiarizados con la sintaxis es definir una función que nos calcula e imprima los resultados para estos estadísticos ponderados. Las funciones son una especie de comando personalizado que nos permiten customizar los cálculos y el output a nuestra necesidad o gusto. (Ver capitulo siguiente sobre uso de funciones)</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="capítulo-2.html#cb14-1" aria-hidden="true" tabindex="-1"></a>my_weighted_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(argumento1, argumento2){</span>
<span id="cb14-2"><a href="capítulo-2.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-3"><a href="capítulo-2.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Mean: &quot;</span>, <span class="fu">wtd.mean</span>(argumento1, <span class="at">w=</span>argumento2), <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb14-4"><a href="capítulo-2.html#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Sd: &quot;</span>, <span class="fu">sqrt</span>(<span class="fu">wtd.var</span>(argumento1, <span class="at">w=</span>argumento2)), <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb14-5"><a href="capítulo-2.html#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">wtd.quantile</span>(bra07<span class="sc">$</span>ipcf, <span class="at">probs =</span><span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>) , <span class="at">w=</span>bra07<span class="sc">$</span>pondera))</span>
<span id="cb14-6"><a href="capítulo-2.html#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Min: &quot;</span>, <span class="fu">min</span>(argumento1, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb14-7"><a href="capítulo-2.html#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Max: &quot;</span>, <span class="fu">max</span>(argumento1, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb14-8"><a href="capítulo-2.html#cb14-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-9"><a href="capítulo-2.html#cb14-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Una vez definida la función debemos llamarla por el nombre indicando sus argumentos. En este caso el primero hace referencia a la variable y el segundo al ponderador. La función replica exactamente la información que arrojaría el comando <code>summ</code> en stata ponderando las estimaciones.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="capítulo-2.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_weighted_stats</span>(bra07<span class="sc">$</span>ipcf, bra07<span class="sc">$</span>pondera)</span></code></pre></div>
<pre><code>## [1] &quot;Mean: 588.010997858984&quot;
## [1] &quot;Sd: 977.61663722545&quot;
##      25%      50%      75% 
## 175.0048 337.3586 632.5000 
## [1] &quot;Min: 0.157142862677574&quot;
## [1] &quot;Max: 66000&quot;</code></pre>
<p>Una de las principales ventajas de las funciones es que nos permiten replicar los resultados para distintas encuestas o también para distintos subconjuntos de los datos. Por ejemplo, en el caso de la PNAD 2007 de Brasil, la variable <em>region</em> puede tomar los valores 1, 2, 3, 4 o 5 dependiendo de si la observación corresponde a la región Norte, Nordeste, Sudeste, Sur o Centro-Oeste, respectivamente. Así, las líneas siguientes pueden utilizarse para computar los estadísticos para dichas regiones, replicando aquí las columnas “Norte” y “Nordeste” del cuadro 2.1</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="capítulo-2.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_weighted_stats</span>(bra07<span class="sc">$</span>ipcf[bra07<span class="sc">$</span>region<span class="sc">==</span><span class="dv">1</span>], bra07<span class="sc">$</span>pondera[bra07<span class="sc">$</span>region<span class="sc">==</span><span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] &quot;Mean: 406.651799150296&quot;
## [1] &quot;Sd: 764.359150571076&quot;
##      25%      50%      75% 
## 175.0048 337.3586 632.5000 
## [1] &quot;Min: 3.33333325386047&quot;
## [1] &quot;Max: 49591.71875&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="capítulo-2.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_weighted_stats</span>(bra07<span class="sc">$</span>ipcf[bra07<span class="sc">$</span>region<span class="sc">==</span><span class="dv">2</span>], bra07<span class="sc">$</span>pondera[bra07<span class="sc">$</span>region<span class="sc">==</span><span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] &quot;Mean: 354.186269146802&quot;
## [1] &quot;Sd: 662.410458164614&quot;
##      25%      50%      75% 
## 175.0048 337.3586 632.5000 
## [1] &quot;Min: 0.157142862677574&quot;
## [1] &quot;Max: 30120&quot;</code></pre>
<p>Ahora el argumento no son todas las filas de las columnas <em>ipcf</em> y <em>pondera</em> sino solo aquellas que cumplen con la condición de pertenecer a la región 1 y 2 en cada caso, lo que se instrumenta con el subscript <code>[bra07$region==x]</code>.</p>
<p>Siguiendo con el cuadro 2.1 del texto, si quisiéramos replicar el coeficiente de variación, ahora que ya sabemos cómo obtener estadísticas ponderadas, se vuelve muy sencillo. Solo basta con definir un objeto que <em>cv</em> que contenga el cociente entre la media y el desvío estándar.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="capítulo-2.html#cb21-1" aria-hidden="true" tabindex="-1"></a>cv<span class="ot">=</span><span class="fu">sqrt</span>(<span class="fu">wtd.var</span>(bra07<span class="sc">$</span>ipcf, <span class="at">w=</span>bra07<span class="sc">$</span>pondera)) <span class="sc">/</span> <span class="fu">wtd.mean</span>(bra07<span class="sc">$</span>ipcf, <span class="at">w=</span>bra07<span class="sc">$</span>pondera)</span>
<span id="cb21-2"><a href="capítulo-2.html#cb21-2" aria-hidden="true" tabindex="-1"></a>cv</span></code></pre></div>
<pre><code>## [1] 1.662582</code></pre>
<p>Y si quisiéramos estimarlo para una región en particular solo deberíamos aplicar el subscript de la misma forma que lo hicimos antes en la función.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="capítulo-2.html#cb23-1" aria-hidden="true" tabindex="-1"></a>cv<span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">wtd.var</span>(bra07<span class="sc">$</span>ipcf[bra07<span class="sc">$</span>region<span class="sc">==</span><span class="dv">1</span>], <span class="at">w=</span>bra07<span class="sc">$</span>pondera[bra07<span class="sc">$</span>region<span class="sc">==</span><span class="dv">1</span>])) <span class="sc">/</span> </span>
<span id="cb23-2"><a href="capítulo-2.html#cb23-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">wtd.mean</span>(bra07<span class="sc">$</span>ipcf[bra07<span class="sc">$</span>region<span class="sc">==</span><span class="dv">1</span>], <span class="at">w=</span>bra07<span class="sc">$</span>pondera[bra07<span class="sc">$</span>region<span class="sc">==</span><span class="dv">1</span>]) </span>
<span id="cb23-3"><a href="capítulo-2.html#cb23-3" aria-hidden="true" tabindex="-1"></a>cv</span></code></pre></div>
<pre><code>## [1] 1.87964</code></pre>
<p>La primera columna del cuadro 2.1 muestra además la población de referencia o número de observaciones expandidas. Para calcularlo basta con sumar la columna pondera, es decir sumar a cada persona aumentándola por su factor de expansión. De esta forma vemos que la población de referencia de la PNAD 2007 es 187 millones de personas aproximadamente.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="capítulo-2.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#número de observaciones expandidas</span></span>
<span id="cb25-2"><a href="capítulo-2.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(bra07<span class="sc">$</span>pondera)</span></code></pre></div>
<pre><code>## [1] 182639476</code></pre>
<p>El ejemplo del texto finaliza con el cómputo de la pobreza en Brasil para el año 2007, utilizando una línea de pobreza de 130 reales mensuales. Una forma sencilla de computar la proporción de individuos con ingresos mensuales menores a 130 reales es mediante el bloque de código siguiente, donde primero se genera una variable binaria <em>“pobre”</em> a partir del comando <code>ifelse</code>, que asignará el valor 1 en caso de que el individuo no supere el umbral monetario y 0 en caso contrario, y luego se computa simplemente su media e imprime el resultado redondeado a 2 decimales.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="capítulo-2.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#identificar individuos pobres</span></span>
<span id="cb27-2"><a href="capítulo-2.html#cb27-2" aria-hidden="true" tabindex="-1"></a>bra07 <span class="ot">&lt;-</span> bra07 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">pobre=</span><span class="fu">ifelse</span>(ipcf<span class="sc">&lt;</span><span class="fl">129.883</span>, <span class="dv">1</span>, <span class="dv">0</span>)) </span>
<span id="cb27-3"><a href="capítulo-2.html#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="capítulo-2.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#total país</span></span>
<span id="cb27-5"><a href="capítulo-2.html#cb27-5" aria-hidden="true" tabindex="-1"></a>pobres_pais <span class="ot">=</span> <span class="fu">wtd.mean</span>(bra07<span class="sc">$</span>pobre, bra07<span class="sc">$</span>pondera)</span>
<span id="cb27-6"><a href="capítulo-2.html#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;shr pobres=&quot;</span>, <span class="fu">round</span>(pobres_pais, <span class="at">d=</span><span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;shr pobres= 0.16&quot;</code></pre>
<p>El mismo resultado podría obtenerse como el cociente de la suma ponderada de personas pobres sobre el total de población.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="capítulo-2.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#otra forma</span></span>
<span id="cb29-2"><a href="capítulo-2.html#cb29-2" aria-hidden="true" tabindex="-1"></a>pobres_pais <span class="ot">=</span> <span class="fu">sum</span>(bra07<span class="sc">$</span>pondera[bra07<span class="sc">$</span>pobre<span class="sc">==</span><span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="fu">sum</span>(bra07<span class="sc">$</span>pondera)</span>
<span id="cb29-3"><a href="capítulo-2.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;shr pobres=&quot;</span>, <span class="fu">round</span>(pobres_pais, <span class="at">d=</span><span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;shr pobres= 0.16&quot;</code></pre>
<p>Para calcular la tasa de pobreza para una región en vez de todo el país, basta simplemente con filtrar las observaciones.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="capítulo-2.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Region Norte</span></span>
<span id="cb31-2"><a href="capítulo-2.html#cb31-2" aria-hidden="true" tabindex="-1"></a>pobres_norte <span class="ot">=</span> <span class="fu">wtd.mean</span>(bra07<span class="sc">$</span>pobre[bra07<span class="sc">$</span>region<span class="sc">==</span><span class="dv">1</span>], bra07<span class="sc">$</span>pondera[bra07<span class="sc">$</span>region<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb31-3"><a href="capítulo-2.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;shr pobres=&quot;</span>, <span class="fu">round</span>(pobres_norte, <span class="at">d=</span><span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;shr pobres= 0.23&quot;</code></pre>
</div>
<div id="histogramas" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Histogramas</h2>
<p>###- (pág 76)</p>
<p>Siguiendo al apéndice del libro mostramos cómo puede graficarse un histograma de la distribución del ipcf en México para el año 2006 (figuras 2.2 a 2.8 del texto). Al igual que en el ejemplo de Brasil, el lector puede obtener la ENIGH (Encuesta Nacional de Ingresos y Gastos de los Hogares) mexicana de 2006 del sitio web del libro. La misma también cuenta con las variables ipcf y pondera que utilizaremos en lo que resta de este apéndice</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="capítulo-2.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cargo base</span></span>
<span id="cb33-2"><a href="capítulo-2.html#cb33-2" aria-hidden="true" tabindex="-1"></a>mex06 <span class="ot">&lt;-</span> <span class="fu">read.dta</span>(data_dir <span class="sc">%+%</span> <span class="st">&quot;Mex/2006/bases/mex06_cedlas.dta&quot;</span>)  </span>
<span id="cb33-3"><a href="capítulo-2.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="capítulo-2.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#elimino observaciones incoherentes, con ingreso missing o cero</span></span>
<span id="cb33-5"><a href="capítulo-2.html#cb33-5" aria-hidden="true" tabindex="-1"></a>mex06 <span class="ot">&lt;-</span> mex06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cohh<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(ipcf) <span class="sc">&amp;</span> ipcf<span class="sc">!=</span><span class="dv">0</span>) </span></code></pre></div>
<p>Para graficar optamos por la librería más extendida en uso en R, <code>ggplot2</code>, ya que tiene una enorme variedad de gráficos y mantiene un sintaxis común. Para graficar existen básicamente 3 ítems o funciones comunes que todos los gráficos deben tener:</p>
<ul>
<li><strong><code>ggplot()</code></strong>: Es la función que da inicio al gráfico, indicando que un objeto grafico va a generarse.
<ul>
<li>data: como primer argumento debemos pasarle el <em>dataframe</em> donde se encuentran las variables a graficar</li>
<li>aes: es el segundo argumento donde indicamos el o los ejes (x e y) y la diversificación de colores o formas según los grupos en los que se dividen los datos (por ejemplo si fuéramos a graficar líneas de tendencia y quisiéramos obtener una línea de color diferente para cada región)</li>
</ul></li>
<li><strong><code>geom_...()</code></strong>: donde los puntos se completan con el tipo de grafico que queremos. Existe una función para cada gráfico. En el caso de un gráfico de líneas será por ejemplo “geom_line”</li>
<li><strong>customización</strong>: existe múltiples funciones y casi infinitas combinaciones para adaptar el grafico en sus escalas, colores, títulos, dimensiones, fuente de los ejes, leyendas, faceteado, etc.</li>
</ul>
<p>A continuación, siguiendo estas líneas generales, graficamos un histograma para el ipcf, empleando la función <code>geom_histom</code>. Igual que antes, <code>[w=pondera]</code> indica que cada observación de la encuesta debe expandirse según la cantidad de individuos que representa. La opción bin(100) especifica que el histograma debe identificar 100 grupos (100 barras). Por último el termino <code>stat(count) / sum(count)</code> para estimar valores del eje y en proporciones y no en valores absolutos. Los demás son pequeñas customizaciones de títulos y colores que el lector podrá entender fácilmente.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="capítulo-2.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.2 - histograma ipcf</span></span>
<span id="cb34-2"><a href="capítulo-2.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>mex06, </span>
<span id="cb34-3"><a href="capítulo-2.html#cb34-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ipcf, <span class="at">weight=</span>pondera)) <span class="sc">+</span> </span>
<span id="cb34-4"><a href="capítulo-2.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">stat</span>(count) <span class="sc">/</span> <span class="fu">sum</span>(count)),</span>
<span id="cb34-5"><a href="capítulo-2.html#cb34-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-6"><a href="capítulo-2.html#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;proporción&quot;</span>, <span class="at">x=</span><span class="st">&quot;ingreso per cápita familiar&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-16-1.png" width="80%" /></p>
<p>Con las líneas siguientes se filtra la base para individuos con ipcf menor a 1500 para evitar la típica distorsión generada por los valores extremos.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="capítulo-2.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.3 - histograma ipcf sin outliers</span></span>
<span id="cb35-2"><a href="capítulo-2.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>mex06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ipcf <span class="sc">&lt;</span> <span class="dv">15000</span>), </span>
<span id="cb35-3"><a href="capítulo-2.html#cb35-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ipcf, <span class="at">weight=</span>pondera)) <span class="sc">+</span> </span>
<span id="cb35-4"><a href="capítulo-2.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">stat</span>(count) <span class="sc">/</span> <span class="fu">sum</span>(count)),</span>
<span id="cb35-5"><a href="capítulo-2.html#cb35-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-6"><a href="capítulo-2.html#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;proporción&quot;</span>, <span class="at">x=</span><span class="st">&quot;ingreso per cápita familiar&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-17-1.png" width="80%" /></p>
<p>Las figuras 2.4 y 2.5 del texto pueden replicarse utilizando el bloque de código siguiente. En la primera se grafica el logaritmo de la variable ipcf, indicando la función <code>log</code> para el eje x. En la siguiente se incrementa sucesivamente el número de barras del histograma. Para ello podríamos repetir 4 veces el gráfico cambiando solamente la cantidad de bins. Aquí optamos por presentar un solución más elegante en la que generamos los 4 gráficos a partir de un bucle que itera sobre el número de bins deseado. El lector no familiarizado con los bucles puede optar por la primera opción hasta que en los siguientes capítulos presentemos con más detalle cómo se introducen iteraciones mediante bucles.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="capítulo-2.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.4 - histograma logaritmo ipcf</span></span>
<span id="cb36-2"><a href="capítulo-2.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mex06, </span>
<span id="cb36-3"><a href="capítulo-2.html#cb36-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(ipcf), <span class="at">weight=</span>pondera)) <span class="sc">+</span> </span>
<span id="cb36-4"><a href="capítulo-2.html#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">stat</span>(count) <span class="sc">/</span> <span class="fu">sum</span>(count)),</span>
<span id="cb36-5"><a href="capítulo-2.html#cb36-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-6"><a href="capítulo-2.html#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;proporción&quot;</span>, <span class="at">x=</span><span class="st">&quot;ingreso per cápita familiar&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-18-1.png" width="80%" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="capítulo-2.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.5 - histogramas con diferente cantidad de intervalos</span></span>
<span id="cb37-2"><a href="capítulo-2.html#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="capítulo-2.html#cb37-3" aria-hidden="true" tabindex="-1"></a>n_bins <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">1000</span>)</span>
<span id="cb37-4"><a href="capítulo-2.html#cb37-4" aria-hidden="true" tabindex="-1"></a>my_graphs <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb37-5"><a href="capítulo-2.html#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="capítulo-2.html#cb37-6" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb37-7"><a href="capítulo-2.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> n_bins){</span>
<span id="cb37-8"><a href="capítulo-2.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-9"><a href="capítulo-2.html#cb37-9" aria-hidden="true" tabindex="-1"></a>    my_graphs[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mex06, </span>
<span id="cb37-10"><a href="capítulo-2.html#cb37-10" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(ipcf), <span class="at">weight=</span>pondera)) <span class="sc">+</span> </span>
<span id="cb37-11"><a href="capítulo-2.html#cb37-11" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">geom_histogram</span>(<span class="at">bins =</span> n, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">stat</span>(count) <span class="sc">/</span> <span class="fu">sum</span>(count)),</span>
<span id="cb37-12"><a href="capítulo-2.html#cb37-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb37-13"><a href="capítulo-2.html#cb37-13" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;proporción&quot;</span>, <span class="at">x=</span><span class="st">&quot;ingreso per cápita familiar&quot;</span>) <span class="sc">+</span></span>
<span id="cb37-14"><a href="capítulo-2.html#cb37-14" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">ggtitle</span>( n <span class="sc">%+%</span> <span class="st">&quot; intervalos&quot;</span>) <span class="sc">+</span></span>
<span id="cb37-15"><a href="capítulo-2.html#cb37-15" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb37-16"><a href="capítulo-2.html#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="capítulo-2.html#cb37-17" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span>  </span>
<span id="cb37-18"><a href="capítulo-2.html#cb37-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-19"><a href="capítulo-2.html#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="capítulo-2.html#cb37-20" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span>  my_graphs[[<span class="dv">1</span>]]</span>
<span id="cb37-21"><a href="capítulo-2.html#cb37-21" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span>  my_graphs[[<span class="dv">2</span>]]</span>
<span id="cb37-22"><a href="capítulo-2.html#cb37-22" aria-hidden="true" tabindex="-1"></a>g3 <span class="ot">&lt;-</span>  my_graphs[[<span class="dv">3</span>]]</span>
<span id="cb37-23"><a href="capítulo-2.html#cb37-23" aria-hidden="true" tabindex="-1"></a>g4 <span class="ot">&lt;-</span>  my_graphs[[<span class="dv">4</span>]]</span>
<span id="cb37-24"><a href="capítulo-2.html#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="capítulo-2.html#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb37-26"><a href="capítulo-2.html#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(g1, g2, g3, g4, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-19-1.png" width="80%" /></p>
</div>
<div id="función-de-distribución" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Función de distribución</h2>
<p>###- (pág. 78)</p>
<p>En este apartado se muestra cómo pueden graficarse las funciones de distribución presentadas en la sección 2.3.2 del cuerpo principal del capítulo. El primer paso para construir una función de distribución es ordenar (de menor a mayor) las observaciones de la encuestas, según la variable de ingreso elegida, ipcf en nuestro caso. Esto es lo que hacemos en la primera línea. En la línea siguiente se crea la variable <em>“shrpop”</em> para almacenar la proporción relativa acumulada de la variable pondera, es decir el porcentaje acumulado de la población que representa cada observación más todas las anteriores. <em>“shrpop”</em> tendrá entonces un valor de 100 para la última observación. Para obtener la suma acumulada expandida empleamos el comenado <code>cumsum()</code> y lo dividimos por el total de población expandido que se obtiene con <code>sum()</code>. La función de distribución presenta las variables shrpop e ipcf en los ejes vertical y horizontal, respectivamente, como se indica en <code>aes()</code>, y se se grafica simplemente con una línea, por lo que usamos el comando <code>geom_line()</code>, donde solo especificamos su tamaño o grosor.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="capítulo-2.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ordenar según ipcf</span></span>
<span id="cb38-2"><a href="capítulo-2.html#cb38-2" aria-hidden="true" tabindex="-1"></a>mex06 <span class="ot">&lt;-</span> mex06 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ipcf)</span>
<span id="cb38-3"><a href="capítulo-2.html#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="capítulo-2.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#población acumulada ordenamiento ipcf</span></span>
<span id="cb38-5"><a href="capítulo-2.html#cb38-5" aria-hidden="true" tabindex="-1"></a>mex06 <span class="ot">&lt;-</span> mex06 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">shrpop=</span><span class="fu">cumsum</span>(pondera)<span class="sc">/</span><span class="fu">sum</span>(pondera))</span>
<span id="cb38-6"><a href="capítulo-2.html#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="capítulo-2.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.9 - función de distribución acumulada</span></span>
<span id="cb38-8"><a href="capítulo-2.html#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mex06, <span class="fu">aes</span>(<span class="at">x=</span>ipcf, <span class="at">y=</span>shrpop))<span class="sc">+</span></span>
<span id="cb38-9"><a href="capítulo-2.html#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb38-10"><a href="capítulo-2.html#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;proporción&quot;</span>, <span class="at">x=</span><span class="st">&quot;ingreso per cápita familiar&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-20-1.png" width="80%" /></p>
<p>Se deja como ejercicio para el lector elaborar las otras funciones de distribución presentadas en la sección 2.3.2. Por su parte, la curva de Pen (ver figuras 2.12 y 2.13) se construye igual que la función de distribución pero se grafica invirtiendo los ejes.</p>
</div>
<div id="pareto" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Pareto</h2>
<p>###- (pág. 78)</p>
<p>En esta sección se muestra cómo replicar la figura 2.14 del texto, que muestra los diagramas de Pareto para las regiones Noroeste y Sur de México. El procedimiento es muy similar al caso de la función de distribución ya que en esencia representan lo mismo, de forma distinta. El gráfico de Pareto muestra para cada valor del ingreso x el porcentaje de la población que recibe ingresos superiores a ese valor x, en una escala doble logarítmica. El cambio de escala genera una suerte de zoom óptico sobre los estratos de mayores ingresos, permitiendo un examen más detallado de esa parte de la distribución.</p>
<p>Para graficarlo seguimos los pasos anteriores, pero ahora ordenamos a la población por ingreso dentro de cada región y ya no considerando el total país. Para ello agrupamos las observaciones por región con <code>group_by()</code> previo a calcular el share acumulado, de forma tal que este cálculo se haga solo entre individuos de una misma región. En la siguiente línea se genera la variable <em>“lpareto”</em> a partir de la variable <em>“shrpop”</em>, siguiendo la explicación de la sección 2.3.4 del texto. Finalmente se grafica filtrando la base para las regiones de interés e indicando con la opción <em>linetype</em> que queremos un tipo de línea diferente para distinguir por región. Dado que la variable región es numérico empleamos <code>factor()</code> para tratarla como una categórica, que identifica a las regiones. Por último, cómo empleamos la opción <em>linetype</em> con <code>scale_linetype()</code> customizamos las leyendas. Si por ejemplo hubiéramos querido diferenciar las regiones por color, hubiéramos utilizado <em>color</em> dentro de <code>aes()</code> y luego <code>scale_color()</code> para personalizarlo.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="capítulo-2.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#población acumulada por región</span></span>
<span id="cb39-2"><a href="capítulo-2.html#cb39-2" aria-hidden="true" tabindex="-1"></a>mex06 <span class="ot">&lt;-</span> mex06 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">shrpop=</span><span class="fu">cumsum</span>(pondera)<span class="sc">/</span><span class="fu">sum</span>(pondera)) </span>
<span id="cb39-3"><a href="capítulo-2.html#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="capítulo-2.html#cb39-4" aria-hidden="true" tabindex="-1"></a>mex06 <span class="ot">&lt;-</span> mex06 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">lpareto=</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>shrpop)) </span>
<span id="cb39-5"><a href="capítulo-2.html#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="capítulo-2.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.14 - Diagrama de Pareto</span></span>
<span id="cb39-7"><a href="capítulo-2.html#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mex06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region<span class="sc">==</span><span class="dv">1</span> <span class="sc">|</span> region<span class="sc">==</span><span class="dv">6</span>), </span>
<span id="cb39-8"><a href="capítulo-2.html#cb39-8" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(ipcf), <span class="at">y=</span>lpareto, <span class="at">weight=</span>pondera, <span class="at">linetype=</span><span class="fu">factor</span>(region))) <span class="sc">+</span> </span>
<span id="cb39-9"><a href="capítulo-2.html#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb39-10"><a href="capítulo-2.html#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="at">name=</span><span class="st">&quot;Region&quot;</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Noroeste&quot;</span>, <span class="st">&quot;Sur&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb39-11"><a href="capítulo-2.html#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;logaritmo del ingreso per cápita familiar&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-21-1.png" width="80%" /></p>
<p>Las líneas siguientes repiten el ejercicio pero dejando de lado al 1% más rico de la poblacion en cada región.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="capítulo-2.html#cb40-1" aria-hidden="true" tabindex="-1"></a>cutoff<span class="ot">=</span><span class="fl">0.99</span></span>
<span id="cb40-2"><a href="capítulo-2.html#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="capítulo-2.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mex06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>((region<span class="sc">==</span><span class="dv">1</span> <span class="sc">|</span> region<span class="sc">==</span><span class="dv">6</span>) <span class="sc">&amp;</span> (shrpop<span class="sc">&lt;=</span>cutoff)),</span>
<span id="cb40-4"><a href="capítulo-2.html#cb40-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(ipcf), <span class="at">y=</span>lpareto, <span class="at">weight=</span>pondera, <span class="at">linetype=</span><span class="fu">factor</span>(region))) <span class="sc">+</span> </span>
<span id="cb40-5"><a href="capítulo-2.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb40-6"><a href="capítulo-2.html#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="at">name=</span><span class="st">&quot;Region&quot;</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Noroeste&quot;</span>, <span class="st">&quot;Sur&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb40-7"><a href="capítulo-2.html#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;logaritmo del ingreso per cápita familiar&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" width="80%" /></p>
</div>
<div id="box-plot" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Box-plot</h2>
<p>###- (pág. 79)</p>
<p>Aquí se muestra cómo elaborar diagramas de caja o box-plot como los presentados en la sección 2.3.5 del texto. En este caso haremos una excepción y presentamos primero una alternativa más directa a <code>ggplot</code> que permite manejar facilmente los outliers, a partir de la libreria base de R. El grafico 2.17 retoma la sintaxís habitual de ggplot para costruir un box-plot para cada región. El lecto podrá entender rapidamente el código en ambos casos, solo notar que aquí diferenciamos a las regiones por el color de relleno en cada box, especificando la opción <code>fill</code>. Al igual que en el caso anterior usamos <code>factor()</code> para tratar a la variable como categórica y, dado que en este caso irá en el eje x diferenciando a las regiones, le agregamos las labels correspondientes con la función <code>scale_x_discrete()</code>. La opción <code>alpha=</code> la utilizamos para darle transparencia al relleno y <code>legend.position=none</code> para omitir la leyenda de cada color.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="capítulo-2.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Una opción mas directa fuera de ggplot</span></span>
<span id="cb41-2"><a href="capítulo-2.html#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="capítulo-2.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.15 - Box Plot</span></span>
<span id="cb41-4"><a href="capítulo-2.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(mex06<span class="sc">$</span>ipcf, <span class="at">outline =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-1.png" width="80%" /></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="capítulo-2.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.16 - Box Plot en log</span></span>
<span id="cb42-2"><a href="capítulo-2.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">log</span>(mex06<span class="sc">$</span>ipcf), <span class="at">outline =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-2.png" width="80%" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="capítulo-2.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figura 2.17  - Box Plot en log por regiones</span></span>
<span id="cb43-2"><a href="capítulo-2.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mex06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region<span class="sc">==</span><span class="dv">1</span> <span class="sc">|</span> region<span class="sc">==</span><span class="dv">6</span>), </span>
<span id="cb43-3"><a href="capítulo-2.html#cb43-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(region), <span class="at">y=</span><span class="fu">log</span>(ipcf), <span class="at">weight=</span>pondera, <span class="at">fill=</span><span class="fu">factor</span>(region))) <span class="sc">+</span> </span>
<span id="cb43-4"><a href="capítulo-2.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha=</span><span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb43-5"><a href="capítulo-2.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span> </span>
<span id="cb43-6"><a href="capítulo-2.html#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Noroeste&quot;</span>,<span class="st">&quot;Sur&quot;</span>)) <span class="sc">+</span></span>
<span id="cb43-7"><a href="capítulo-2.html#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Región&quot;</span>, <span class="at">y =</span><span class="st">&quot;log ipcf&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-3.png" width="80%" /></p>
</div>
<div id="curva-de-lorenz" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Curva de Lorenz</h2>
<p>###- (pág. 80)</p>
<p>En este apartado se muestra cómo pueden construirse las curvas de Lorenz introducidas en la sección 2.3.6 del capítulo. El primer paso consiste en ordenar a los individuos de menor a mayor según su ingreso, en nuestro caso contenido en la variable ipcf. Para ellos aplicamos la función <code>arrange()</code>. Notar que previo a esto se aplica la función <code>ungroup()</code>, lo cual es siempre recomendable cuando en la misma base previamente se había realizado una agrupación, para de alguna forma resetear el agrupamiento. Las líneas siguientes generan la variable <em>“shrpop”</em> de la misma forma en la que fue generada más arriba, para construir el eje vertical de la función de distribución: contiene la proporción de la población que se acumula hasta cada observación de la encuesta. La diferencia es que ahora también generaremos una variable <em>“shrinc”</em> que contiene la proporción del ingreso que se acumula hasta cada observación de la encuesta y se estima expandiendo el ingreso por el factor de expansión, es decir multiplicando ambas columnas como puede verse en el código.</p>
<p>La curva de Lorenz nos muestra qué porcentaje de la población acumula un dado porcentaje del ingreso total. Para visualizarlo indicamos entonces los ejes respectivos para <em>“shrpop”</em> y <em>“shrinc”</em> y luego aplicamos un gráfico de línea como <code>geom_line()</code>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="capítulo-2.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ordenar según ipcf</span></span>
<span id="cb44-2"><a href="capítulo-2.html#cb44-2" aria-hidden="true" tabindex="-1"></a>mex06 <span class="ot">&lt;-</span> mex06 <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ipcf)</span>
<span id="cb44-3"><a href="capítulo-2.html#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="capítulo-2.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#población e ingreso acumulado</span></span>
<span id="cb44-5"><a href="capítulo-2.html#cb44-5" aria-hidden="true" tabindex="-1"></a>mex06 <span class="ot">&lt;-</span> mex06 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">shrpop=</span><span class="fu">cumsum</span>(pondera)<span class="sc">/</span><span class="fu">sum</span>(pondera),</span>
<span id="cb44-6"><a href="capítulo-2.html#cb44-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">shrinc=</span><span class="fu">cumsum</span>(ipcf<span class="sc">*</span>pondera)<span class="sc">/</span><span class="fu">sum</span>(ipcf<span class="sc">*</span>pondera)) </span>
<span id="cb44-7"><a href="capítulo-2.html#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="capítulo-2.html#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.18 - curva de Lorenz </span></span>
<span id="cb44-9"><a href="capítulo-2.html#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mex06, <span class="fu">aes</span>(<span class="at">x=</span>shrpop, <span class="at">y=</span>shrinc)) <span class="sc">+</span></span>
<span id="cb44-10"><a href="capítulo-2.html#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-24-1.png" width="80%" /></p>
<p>En las líneas siguientes se comparan las curvas de Lorenz para dos regiones de México. El código sigue los mismos pasos que antes pero ahora los cálculos de población e ingreso acumulado se realizan por región, agregando un <code>group_by()</code>. En el gráfico filtramos las regiones en cuestión y las diferenciamos con distintos tipos de líneas con la opción <em>linetype</em>, al igual que antes. Con <code>theme_bw()</code> modificamos un poco el aspecto visual del gráfico.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="capítulo-2.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ordenar según ipcf + región y acumular por región</span></span>
<span id="cb45-2"><a href="capítulo-2.html#cb45-2" aria-hidden="true" tabindex="-1"></a>mex06 <span class="ot">&lt;-</span> mex06 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(region, ipcf) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="capítulo-2.html#cb45-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="capítulo-2.html#cb45-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">mutate</span>(<span class="at">shrpop=</span><span class="fu">cumsum</span>(pondera)<span class="sc">/</span><span class="fu">sum</span>(pondera),</span>
<span id="cb45-5"><a href="capítulo-2.html#cb45-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">shrinc=</span><span class="fu">cumsum</span>(ipcf<span class="sc">*</span>pondera)<span class="sc">/</span><span class="fu">sum</span>(ipcf<span class="sc">*</span>pondera)) </span>
<span id="cb45-6"><a href="capítulo-2.html#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="capítulo-2.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.19 - curva de lorenz por regiones</span></span>
<span id="cb45-8"><a href="capítulo-2.html#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mex06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region<span class="sc">==</span><span class="dv">1</span> <span class="sc">|</span> region<span class="sc">==</span><span class="dv">6</span>),</span>
<span id="cb45-9"><a href="capítulo-2.html#cb45-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>shrpop, <span class="at">y=</span>shrinc, <span class="at">linetype=</span><span class="fu">factor</span>(region))) <span class="sc">+</span></span>
<span id="cb45-10"><a href="capítulo-2.html#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb45-11"><a href="capítulo-2.html#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="at">name=</span><span class="st">&quot;Region&quot;</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Noroeste&quot;</span>, <span class="st">&quot;Sur&quot;</span>)) <span class="sc">+</span></span>
<span id="cb45-12"><a href="capítulo-2.html#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-25-1.png" width="80%" /></p>
</div>
<div id="curva-generalizada-de-lorenz" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Curva Generalizada de Lorenz</h2>
<p>###- (pág. 81)</p>
<p>La curva generalizada de Lorenz se construye a partir de la curva de Lorenz pero multiplicando su eje vertical por el ingreso promedio (ver sección 2.3.6) en el cuerpo del capítulo. Las líneas no se modifican respecto de las utilizadas para estimar la curva de Lorenz, salvo en que ahora la variable <em>shrpop</em> la generamos ahora la base de la variable <em>pondera</em>. Para entender el álgebra detrás de esta forma de calcular la curva generalizada de Lorenz, el lector puede remitirse a los apéndices del libro (pagina 81-82) donde queda claramente explicitado.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="capítulo-2.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ordenar según ipcf + región y acumular por región</span></span>
<span id="cb46-2"><a href="capítulo-2.html#cb46-2" aria-hidden="true" tabindex="-1"></a>mex06 <span class="ot">&lt;-</span> mex06 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(region, ipcf) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="capítulo-2.html#cb46-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="capítulo-2.html#cb46-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">mutate</span>(<span class="at">shrpop=</span><span class="fu">cumsum</span>(pondera)<span class="sc">/</span><span class="fu">sum</span>(pondera),</span>
<span id="cb46-5"><a href="capítulo-2.html#cb46-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">glorenz=</span><span class="fu">cumsum</span>(ipcf<span class="sc">*</span>pondera)<span class="sc">/</span><span class="fu">sum</span>(pondera)) </span>
<span id="cb46-6"><a href="capítulo-2.html#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="capítulo-2.html#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.20 - curva de Lorenz generalizada por regiones</span></span>
<span id="cb46-8"><a href="capítulo-2.html#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mex06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region<span class="sc">==</span><span class="dv">1</span> <span class="sc">|</span> region<span class="sc">==</span><span class="dv">6</span>),</span>
<span id="cb46-9"><a href="capítulo-2.html#cb46-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>shrpop, <span class="at">y=</span>glorenz, <span class="at">linetype=</span><span class="fu">factor</span>(region))) <span class="sc">+</span></span>
<span id="cb46-10"><a href="capítulo-2.html#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb46-11"><a href="capítulo-2.html#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="at">name=</span><span class="st">&quot;Region&quot;</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Noroeste&quot;</span>, <span class="st">&quot;Sur&quot;</span>)) <span class="sc">+</span></span>
<span id="cb46-12"><a href="capítulo-2.html#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-26-1.png" width="80%" /></p>
</div>
<div id="curva-de-incidencia" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Curva de Incidencia</h2>
<p>###- (pág. 83)</p>
<p>En este apartado se muestra cómo pueden estimarse las curvas de incidencia del crecimiento que aparecen en la figura 2.21 del texto. A modo de ejemplo, se computa la curva de incidencia del crecimiento para Argentina, 1992-2006, utilizando percentiles del ingreso per cápita familiar. Para ello el lector deberá descargar dichas bases en su directorio de trabajo.</p>
<p>La idea básica será generar un bucle que en cada repetición cargue una base, ordene por ipcf, genere el porcentaje de población acumulado, en base a este identifique a qué percentil de ingreso corresponde y finalmente agrupando por percentiles estime la media del ingreso en cada uno. Dado que tenemos dos bases distintas, el bucle iterará dos veces.</p>
<p>Para implementarlo se propone utilizar una lista (objeto tipo <em>list</em>), en la que la EPH de cada año va a ser un elemento distinto. Así el primer elemento de esa lista corresponderá a toda la base de 1992 y el segundo, a toda la base del 2006. Para señalar el primer y segundo elemento nos valemos de un contador <em>i</em> que en la primer iteración del bucle valdrá uno, y al que iremos sumando de uno en uno, por lo que en la segunda tomará valor dos. Por eso la expresión <code>bases_mod[[i]]</code> será equivalente a decir “elemento 1 de la lista <em>bases_mod</em>” en la primera iteración y “elemento 2 de la lista <em>bases_mod</em>” en la segunda iteración. Con esto logramos que en vez de ordenar, generar y cambiar variables sobre un dataframe estático, lo hagamos sucesivamente sobre dataframes distintos contenidos en un lista “madre,” que aquí llamamos <em>bases_mod</em>.</p>
<p>Nuestro bucle irá iterando sobre <em>j</em>, que al igual que <em>i</em> cambiará de valor en cada vuelta. En la primera será 92 y en la segunda 06 y nos servirá para indicar con qué base trabajar. Así <code>read.dta()</code> tiene como argumento la función <code>paste()</code> que une el prefijo <em>“arg”</em> al año de la base correspondiente (<em>j</em>), generando, junto con el prefijo <em>“dta”</em>, un string igual al nombre de la base completa. De esta forma logramos cambiar el nombre en cada iteración para cargar bases de años diferentes.</p>
<p>Dado que estamos trabajando con años distintos debemos prever que necesitaremos ajustar los valores de ingresos por inflación. Por eso en caso de que la base sea la del 92, se multiplica el ipcf por el factor de ajuste (2.099). Esto se debe hacer solo en el caso de la base de 1992 y la manera de instrumentarlo es diciéndole a R que ese cambio debe realizarse solo cuando j sea igual a 92 -<code>if (j=="92")</code>-.</p>
<p>Una vez cargada la base, logrado el ajuste por inflación, aplicamos los mismos pasos que antes para ordenar por ipcf a la población y calcular el porcentaje acumulado. Con ese porcentaje acumulado generaremos los percentiles anidando un bucle a nuestro bucle inicial, que por cada base hará 100 repeticiones. En cada una de ellas asignará los percentiles en base a <em>shrpop</em> ayudándose de la variable <em>z</em> multiplicada por 0.01. Esto porque si queremos generar percentiles (n=100), necesitamos 100 cuantiles por lo que cada cuantil se asigna de a intervalos de población acumulada iguales a 0.01 (1/100). Así por ejemplo, cuando z sea igual a 20, <code>(z-1)*0.01</code> será igual a 0.19 y <code>z*0.01</code> a 0.20, por lo que caerán en este cuantil veinte, todos aquellos individuos que ordenados por ingreso, estén entre el 19 y el 20 por ciento de población acumulada. Dado que empleamos el comando <code>ifelse()</code>, para las obserservaciones restantes que caen fuera de este intervalo, se mantendrá el valor que ya traía la variable <em>“percentil”</em>. Es por esto que antes del bucle, la generamos como vacía, para luego ir rellenándola sucesivamente. <em>z</em> continuará incrementándose de a uno, hasta llegar a 100, donde asigne el último percentil a aquellas personas que quedaron ultimas en nuestra ordenación, ya que poseían los ingresos mas alto. Al considerar a este 1% de la población faltante, se habrá acumulado al 100%. Finalmente el último paso, consiste en reducir todo el dataframe a 100 observaciones correspondientes a los 100 cuantiles creados y calcular la media del ingreso de las personas que pertenezcan a cada percentil.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="capítulo-2.html#cb47-1" aria-hidden="true" tabindex="-1"></a>bases_mod <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co">#lista vacia en la que se guardaran los cambios</span></span>
<span id="cb47-2"><a href="capítulo-2.html#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="capítulo-2.html#cb47-3" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span>              <span class="co">#contador para iterar sobre los elementos de la lista</span></span>
<span id="cb47-4"><a href="capítulo-2.html#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="capítulo-2.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#j tomará valor 92 y 06</span></span>
<span id="cb47-6"><a href="capítulo-2.html#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;92&quot;</span>,<span class="st">&quot;06&quot;</span>)){     </span>
<span id="cb47-7"><a href="capítulo-2.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-8"><a href="capítulo-2.html#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cargo base</span></span>
<span id="cb47-9"><a href="capítulo-2.html#cb47-9" aria-hidden="true" tabindex="-1"></a>  bases_mod[[i]] <span class="ot">&lt;-</span> <span class="fu">read.dta</span>(data_dir <span class="sc">%+%</span> <span class="fu">paste</span>(<span class="st">&quot;Arg/bases/arg&quot;</span>,j,<span class="st">&quot;_cedlas.dta&quot;</span>, <span class="at">sep =</span><span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-10"><a href="capítulo-2.html#cb47-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter</span>(cohh<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(ipcf))</span>
<span id="cb47-11"><a href="capítulo-2.html#cb47-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-12"><a href="capítulo-2.html#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ajuste por inflación para el año 92 solamente</span></span>
<span id="cb47-13"><a href="capítulo-2.html#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (j<span class="sc">==</span><span class="st">&quot;92&quot;</span>){</span>
<span id="cb47-14"><a href="capítulo-2.html#cb47-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-15"><a href="capítulo-2.html#cb47-15" aria-hidden="true" tabindex="-1"></a>      bases_mod[[i]] <span class="ot">&lt;-</span> bases_mod[[i]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ipcf=</span>ipcf<span class="sc">*</span><span class="fl">2.099</span>)   <span class="co">#ver comentarios para este coeficiente</span></span>
<span id="cb47-16"><a href="capítulo-2.html#cb47-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-17"><a href="capítulo-2.html#cb47-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-18"><a href="capítulo-2.html#cb47-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-19"><a href="capítulo-2.html#cb47-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ordenar según ipcf</span></span>
<span id="cb47-20"><a href="capítulo-2.html#cb47-20" aria-hidden="true" tabindex="-1"></a>  bases_mod[[i]] <span class="ot">&lt;-</span> bases_mod[[i]] <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ipcf)</span>
<span id="cb47-21"><a href="capítulo-2.html#cb47-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-22"><a href="capítulo-2.html#cb47-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#computar porcentaje de población</span></span>
<span id="cb47-23"><a href="capítulo-2.html#cb47-23" aria-hidden="true" tabindex="-1"></a>  bases_mod[[i]] <span class="ot">&lt;-</span> bases_mod[[i]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">shrpop=</span><span class="fu">cumsum</span>(pondera)<span class="sc">/</span><span class="fu">sum</span>(pondera))</span>
<span id="cb47-24"><a href="capítulo-2.html#cb47-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-25"><a href="capítulo-2.html#cb47-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#identificar percentil de ipcf</span></span>
<span id="cb47-26"><a href="capítulo-2.html#cb47-26" aria-hidden="true" tabindex="-1"></a>  bases_mod[[i]] <span class="ot">&lt;-</span> bases_mod[[i]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">percentile=</span><span class="dv">0</span>)  <span class="co">#esto es equivalente a gen percentile=. en stata</span></span>
<span id="cb47-27"><a href="capítulo-2.html#cb47-27" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-28"><a href="capítulo-2.html#cb47-28" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (z <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb47-29"><a href="capítulo-2.html#cb47-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-30"><a href="capítulo-2.html#cb47-30" aria-hidden="true" tabindex="-1"></a>        bases_mod[[i]] <span class="ot">&lt;-</span> bases_mod[[i]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">percentile=</span><span class="fu">ifelse</span>((shrpop<span class="sc">&gt;</span>(z<span class="dv">-1</span>)<span class="sc">*</span><span class="fl">0.01</span> <span class="sc">&amp;</span> shrpop<span class="sc">&lt;=</span>z<span class="sc">*</span><span class="fl">0.01</span>), z,                                                                                percentile)) </span>
<span id="cb47-31"><a href="capítulo-2.html#cb47-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-32"><a href="capítulo-2.html#cb47-32" aria-hidden="true" tabindex="-1"></a>      }  </span>
<span id="cb47-33"><a href="capítulo-2.html#cb47-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-34"><a href="capítulo-2.html#cb47-34" aria-hidden="true" tabindex="-1"></a>  bases_mod[[i]] <span class="ot">&lt;-</span> bases_mod[[i]] <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(percentile) <span class="sc">%&gt;%</span> </span>
<span id="cb47-35"><a href="capítulo-2.html#cb47-35" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">summarise</span>(<span class="at">ipcf=</span><span class="fu">wtd.mean</span>(ipcf, <span class="at">w=</span>pondera, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb47-36"><a href="capítulo-2.html#cb47-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-37"><a href="capítulo-2.html#cb47-37" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span>  </span>
<span id="cb47-38"><a href="capítulo-2.html#cb47-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-39"><a href="capítulo-2.html#cb47-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Cuando el bucle finaliza, podemos “recuperar” como dataframes los elementos almacenados en nuestra lista <em>bases_mod</em>. El primero corresponde a los ingresos promedios de cada percentil construidos con la base de 1992 y el segundo en base a los datos de 2006.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="capítulo-2.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#recupero las bases de cada año como respectivos elementos de la lista</span></span>
<span id="cb48-2"><a href="capítulo-2.html#cb48-2" aria-hidden="true" tabindex="-1"></a>arg92 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(bases_mod[[<span class="dv">1</span>]])</span>
<span id="cb48-3"><a href="capítulo-2.html#cb48-3" aria-hidden="true" tabindex="-1"></a>arg06 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(bases_mod[[<span class="dv">2</span>]])</span>
<span id="cb48-4"><a href="capítulo-2.html#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="capítulo-2.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(arg92)</span></code></pre></div>
<pre><code>##   percentile       ipcf
## 1          1   3.022971
## 2          2  48.433713
## 3          3  72.977156
## 4          4  86.696647
## 5          5 102.684227
## 6          6 114.563038</code></pre>
<p>Para finalizar la estimación, debemos calcular el cambio porcentual en el ingreso promedio de cada percentil entre estos años. Para ello necesitaremos juntar ambos dataframes en un solo, a partir de la variable percentil, que se encuentra en ambos. Con el comando <code>merge()</code> unificamos las bases y le asignamos un sufijo que nos permita identificar cada columna. Hecho esto ya podemos calcular el cambio porcentual en el ipcf promedio y graficarlo para cada percentil.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="capítulo-2.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#junto bases, asigno nombres y calculo el cambio porcentual</span></span>
<span id="cb50-2"><a href="capítulo-2.html#cb50-2" aria-hidden="true" tabindex="-1"></a>change <span class="ot">&lt;-</span> <span class="fu">merge</span>(arg92, arg06, <span class="at">by=</span><span class="st">&quot;percentile&quot;</span>, <span class="at">suffix=</span><span class="fu">c</span>(<span class="st">&quot;_92&quot;</span>, <span class="st">&quot;_06&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="capítulo-2.html#cb50-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">change=</span>( (ipcf_06<span class="sc">/</span>ipcf_92) <span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span>) </span>
<span id="cb50-4"><a href="capítulo-2.html#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="capítulo-2.html#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="capítulo-2.html#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Figura 2.21 - Curva de incidencia ipcf</span></span>
<span id="cb50-7"><a href="capítulo-2.html#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(change <span class="sc">%&gt;%</span> <span class="fu">filter</span>(percentile<span class="sc">&gt;</span><span class="dv">2</span>),    <span class="co">#elimino los primeros dos porque son outliers debido a los ipcf=0</span></span>
<span id="cb50-8"><a href="capítulo-2.html#cb50-8" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>percentile, <span class="at">y=</span>change))<span class="sc">+</span></span>
<span id="cb50-9"><a href="capítulo-2.html#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="fl">1.2</span>, <span class="at">color=</span><span class="st">&quot;darkcyan&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-10"><a href="capítulo-2.html#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-11"><a href="capítulo-2.html#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-29"></span>
<img src="_main_files/figure-html/unnamed-chunk-29-1.png" alt="Esta figura presenta resultados en magnitudes diferentes a los reportados orginalmente en el capitulo del libro." width="80%" />
<p class="caption">
Figure 2.1: Esta figura presenta resultados en magnitudes diferentes a los reportados orginalmente en el capitulo del libro.
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="capítulo-3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/02-Cap2_html.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
